let MAIN_BLOCK="dual-listbox",CONTAINER_ELEMENT="dual-listbox__container",AVAILABLE_ELEMENT="dual-listbox__available",SELECTED_ELEMENT="dual-listbox__selected",TITLE_ELEMENT="dual-listbox__title",ITEM_ELEMENT="dual-listbox__item",BUTTONS_ELEMENT="dual-listbox__buttons",BUTTON_ELEMENT="dual-listbox__button",SEARCH_ELEMENT="dual-listbox__search",SELECTED_MODIFIER="dual-listbox__item--selected",DIRECTION_UP="up",DIRECTION_DOWN="down";class DualListbox{constructor(t,e={}){this.setDefaults(),this.dragged=null,this.options=[],DualListbox.isDomElement(t)?this.select=t:this.select=document.querySelector(t),this._initOptions(e),this._initReusableElements(),void 0!==e.options?this.options=e.options:this._splitOptions(this.select.options),this._buildDualListbox(this.select.parentNode),this._addActions(),this.showSortButtons&&this._initializeSortButtons(),this.redraw()}setDefaults(){this.availableTitle="Available options",this.selectedTitle="Selected options",this.showAddButton=!0,this.addButtonText="add",this.showRemoveButton=!0,this.removeButtonText="remove",this.showAddAllButton=!0,this.addAllButtonText="add all",this.showRemoveAllButton=!0,this.removeAllButtonText="remove all",this.searchPlaceholder="Search",this.showSortButtons=!1,this.sortFunction=(t,e)=>t.selected?-1:e.selected?1:t.order<e.order?-1:t.order>e.order?1:0,this.upButtonText="up",this.downButtonText="down",this.enableDoubleClick=!0,this.draggable=!0}changeOrder(t,e){console.log(t);let s=this.options.findIndex(e=>(console.log(e,t.dataset.id),e.value===t.dataset.id));console.log(s);let i=this.options.splice(s,1);console.log(i),this.options.splice(e,0,i[0])}addOptions(t){t.forEach(t=>{this.addOption(t)})}addOption(t,e=null){e?this.options.splice(e,0,t):this.options.push(t)}addEventListener(t,e){this.dualListbox.addEventListener(t,e)}changeSelected(t){let e=this.options.find(e=>e.value===t.dataset.id);e.selected=!e.selected,this.redraw(),setTimeout(()=>{let s=document.createEvent("HTMLEvents");e.selected?(s.initEvent("added",!1,!0),s.addedElement=t):(s.initEvent("removed",!1,!0),s.removedElement=t),this.dualListbox.dispatchEvent(s)},0)}actionAllSelected(t){t&&t.preventDefault(),this.options.forEach(t=>t.selected=!0),this.redraw()}actionAllDeselected(t){t&&t.preventDefault(),this.options.forEach(t=>t.selected=!1),this.redraw()}redraw(){this.options.sort(this.sortFunction),this.updateAvailableListbox(),this.updateSelectedListbox(),this.syncSelect()}searchLists(t,e){let s=e.querySelectorAll(`.${ITEM_ELEMENT}`),i=t.toLowerCase();for(let a=0;a<s.length;a++){let l=s[a],d=l.textContent.toLowerCase(),n;null===(n=RegExp(".*"+i+".*","gm").exec(d))?l.style.display="none":l.style.display="list-item",console.log(a+n)}}updateAvailableListbox(){this._updateListbox(this.availableList,this.options.filter(t=>!t.selected))}updateSelectedListbox(){this._updateListbox(this.selectedList,this.options.filter(t=>t.selected))}syncSelect(){for(;this.select.firstChild;)this.select.removeChild(this.select.lastChild);this.options.forEach(t=>{let e=document.createElement("option");e.value=t.value,e.innerText=t.text,t.selected&&e.setAttribute("selected","selected"),this.select.appendChild(e)})}_updateListbox(t,e){for(;t.firstChild;)t.removeChild(t.firstChild);e.forEach(e=>{t.appendChild(this._createListItem(e))})}actionItemSelected(t){t.preventDefault();let e=this.availableList.querySelector(`.${SELECTED_MODIFIER}`);e&&this.changeSelected(e)}actionItemDeselected(t){t.preventDefault();let e=this.selectedList.querySelector(`.${SELECTED_MODIFIER}`);e&&this.changeSelected(e)}_actionItemDoubleClick(t,e=null){e&&(e.preventDefault(),e.stopPropagation()),this.enableDoubleClick&&this.changeSelected(t)}_actionItemClick(t,e,s=null){s&&s.preventDefault();let i=e.querySelectorAll(`.${ITEM_ELEMENT}`);for(let a=0;a<i.length;a++){let l=i[a];l!==t&&l.classList.remove(SELECTED_MODIFIER)}t.classList.contains(SELECTED_MODIFIER)?t.classList.remove(SELECTED_MODIFIER):t.classList.add(SELECTED_MODIFIER)}_addActions(){this._addButtonActions(),this._addSearchActions()}_addButtonActions(){this.add_all_button.addEventListener("click",t=>this.actionAllSelected(t)),this.add_button.addEventListener("click",t=>this.actionItemSelected(t)),this.remove_button.addEventListener("click",t=>this.actionItemDeselected(t)),this.remove_all_button.addEventListener("click",t=>this.actionAllDeselected(t))}_addClickActions(t){return t.addEventListener("dblclick",e=>this._actionItemDoubleClick(t,e)),t.addEventListener("click",e=>this._actionItemClick(t,this.dualListbox,e)),t}_addSearchActions(){this.search_left.addEventListener("change",t=>this.searchLists(t.target.value,this.availableList)),this.search_left.addEventListener("keyup",t=>this.searchLists(t.target.value,this.availableList)),this.search_right.addEventListener("change",t=>this.searchLists(t.target.value,this.selectedList)),this.search_right.addEventListener("keyup",t=>this.searchLists(t.target.value,this.selectedList))}_buildDualListbox(t){this.select.style.display="none",this.dualListBoxContainer.appendChild(this._createList(this.search_left,this.availableListTitle,this.availableList)),this.dualListBoxContainer.appendChild(this.buttons),this.dualListBoxContainer.appendChild(this._createList(this.search_right,this.selectedListTitle,this.selectedList)),this.dualListbox.appendChild(this.dualListBoxContainer),t.insertBefore(this.dualListbox,this.select)}_createList(t,e,s){let i=document.createElement("div");return i.appendChild(t),i.appendChild(e),i.appendChild(s),i}_createButtons(){this.buttons=document.createElement("div"),this.buttons.classList.add("dual-listbox__buttons"),this.add_all_button=document.createElement("button"),this.add_all_button.innerHTML=this.addAllButtonText,this.add_button=document.createElement("button"),this.add_button.innerHTML=this.addButtonText,this.remove_button=document.createElement("button"),this.remove_button.innerHTML=this.removeButtonText,this.remove_all_button=document.createElement("button"),this.remove_all_button.innerHTML=this.removeAllButtonText;let t={showAddAllButton:this.add_all_button,showAddButton:this.add_button,showRemoveButton:this.remove_button,showRemoveAllButton:this.remove_all_button};for(let e in t)if(e){let s=this[e],i=t[e];i.setAttribute("type","button"),i.classList.add("dual-listbox__button"),s&&this.buttons.appendChild(i)}}_createListItem(t){let e=document.createElement("li");return e.classList.add(ITEM_ELEMENT),e.innerHTML=t.text,e.dataset.id=t.value,this._liListeners(e),this._addClickActions(e),this.draggable&&e.setAttribute("draggable","true"),e}_liListeners(t){t.addEventListener("dragstart",t=>{console.log("drag start",t),this.dragged=t.currentTarget,t.currentTarget.classList.add("dragging")}),t.addEventListener("dragend",t=>{t.currentTarget.classList.remove("dragging")}),t.addEventListener("dragover",t=>{t.preventDefault()},!1),t.addEventListener("dragenter",t=>{("UL"==t.target.nodeName||"LI"==t.target.nodeName)&&t.target.classList.add("drop-above")}),t.addEventListener("dragleave",t=>{("UL"==t.target.nodeName||"LI"==t.target.nodeName)&&t.target.classList.remove("drop-above")}),t.addEventListener("drop",t=>{if("UL"==t.target.nodeName||"LI"==t.target.nodeName){t.preventDefault(),t.stopPropagation(),t.target.classList.remove("drop-above");let e=this.options.findIndex(e=>e.value===t.target.dataset.id);t.target.parentElement===this.dragged.parentElement?(this.changeOrder(this.dragged,e),this.redraw()):(this.changeSelected(this.dragged),this.changeOrder(this.dragged,e),this.redraw())}})}_createSearchLeft(){this.search_left=document.createElement("input"),this.search_left.classList.add(SEARCH_ELEMENT),this.search_left.placeholder=this.searchPlaceholder}_createSearchRight(){this.search_right=document.createElement("input"),this.search_right.classList.add(SEARCH_ELEMENT),this.search_right.placeholder=this.searchPlaceholder}_createDragListeners(){[this.availableList,this.selectedList].forEach(t=>{t.addEventListener("dragover",t=>{t.preventDefault()},!1),t.addEventListener("dragenter",t=>{("UL"==t.target.nodeName||"LI"==t.target.nodeName)&&t.target.classList.add("drop-in")}),t.addEventListener("dragleave",t=>{("UL"==t.target.nodeName||"LI"==t.target.nodeName)&&t.target.classList.remove("drop-in")}),t.addEventListener("drop",e=>{("UL"==e.target.nodeName||"LI"==e.target.nodeName)&&(e.preventDefault(),e.target.classList.remove("drop-in"),(t.classList.contains("dual-listbox__selected")||t.classList.contains("dual-listbox__available"))&&this.changeSelected(this.dragged))})})}_initOptions(t){for(let e in t)t.hasOwnProperty(e)&&(this[e]=t[e])}_initReusableElements(){this.dualListbox=document.createElement("div"),this.dualListbox.classList.add("dual-listbox"),this.select.id&&this.dualListbox.classList.add(this.select.id),this.dualListBoxContainer=document.createElement("div"),this.dualListBoxContainer.classList.add("dual-listbox__container"),this.availableList=document.createElement("ul"),this.availableList.classList.add("dual-listbox__available"),this.selectedList=document.createElement("ul"),this.selectedList.classList.add("dual-listbox__selected"),this.availableListTitle=document.createElement("div"),this.availableListTitle.classList.add(TITLE_ELEMENT),this.availableListTitle.innerText=this.availableTitle,this.selectedListTitle=document.createElement("div"),this.selectedListTitle.classList.add(TITLE_ELEMENT),this.selectedListTitle.innerText=this.selectedTitle,this._createButtons(),this._createSearchLeft(),this._createSearchRight(),this.draggable&&setTimeout(()=>{this._createDragListeners()},10)}_splitOptions(t){[...t].forEach((t,e)=>{this.addOption({text:t.innerHTML,value:t.value,selected:t.attributes.selected||!1,order:e})})}_initializeSortButtons(){let t=document.createElement("button");t.classList.add("dual-listbox__button"),t.innerText=this.upButtonText,t.addEventListener("click",t=>this._onSortButtonClick(t,"up"));let e=document.createElement("button");e.classList.add("dual-listbox__button"),e.innerText=this.downButtonText,e.addEventListener("click",t=>this._onSortButtonClick(t,DIRECTION_DOWN));let s=document.createElement("div");s.classList.add("dual-listbox__buttons"),s.appendChild(t),s.appendChild(e),this.dualListBoxContainer.appendChild(s)}_onSortButtonClick(t,e){t.preventDefault();let s=this.dualListbox.querySelector(".dual-listbox__item--selected");if(this.options.find(t=>t.value===s.dataset.id),s){let i=this._getNewIndex(s,e);i>=0&&(this.changeOrder(s,i),this.redraw())}}_getNewIndex(t,e){let s=this.options.findIndex(e=>e.value===t.dataset.id),i=s;return"up"===e?i-=1:DIRECTION_DOWN===e&&s<t.length-1&&(i+=1),i}static isDomElement(t){return"object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName}}window.DualListbox=DualListbox;
